
<!DOCTYPE html>
<html>
	
<style>
body {

	background-image: url('images/cool-background.png');
	background-attachment: fixed;
	color: #333;
}

</style>

	<head>
		<title>HackTheBox SneakyMailer Writeup </title>
		
		<!-- link to main stylesheet -->
		<link rel="stylesheet" type="css/main.css">
	</head>
	<body>
		<div class="container">
    		<div class="blurb">
        		<h1>HTB SneakyMailer </h1>
				<p> 	
				<img src="images/sneaky/sneaky-header.PNG" alt="sneaky" class="inline"/> <br/> <br/> <br/>
				
				We start out with our usual nmap scan -  <br/> <br/>
				<img src="images/sneaky/nmap.PNG" alt="nmap" class="inline"/> <br/> <br/> <br/>
					
				Initially we can see we have a couple web servers and an email server. I went to checkout the web server on port 80 and discovered a list of emails. 
				<br/> <br/> 
				<img src="images/sneaky/sneaky-corp-home-page.PNG" alt="emails" class="inline"/> <br/> <br/> <br/>
					
				I ran gobuster to see if we could pull out any additional domains or vhosts, and we find dev.sneakcorp.htb. <br/> <br/>
				<img src="images/sneaky/gob1.PNG" alt="emails" class="inline"/> <br/> <br/> <br/>
				<img src="images/sneaky/gob2.PNG" alt="emails" class="inline"/> <br/> <br/> <br/>
					
				Sadly it appeared to have the same info as the normal domain. I checked out the app on port 8080 next. <br/> <br/>
				<img src="images/sneaky/8080-app.PNG" alt="web app on port 8080" class="inline"/> <br/> <br/> <br/>
					
				The FTP server appeared to be a dead end since at this point as we don't have any creds and there is no guest access. <br/>
				Judging by the name of the box and the fact that we have an email list, I started thinking we have to phish a user. <br/> <br/>
					
				I opted to use a tool called swaks - <a href="https://github.com/jetmore/swaks">which you can checkout here</a> <br/> <br/>
				
				Our basic idea is just to get one of the users to click on our ip, and should be able to see the connection in nc and judge where to go from there. <br/>
				I sent out an email to everyone on the list we found earlier, with the simple contents of "Visit 8.8.8.8" where 8.8.8.8 would be my ip. I then opened <br/>
				up a netcat window to see what we get. <br/> <br/>
				<img src="images/sneaky/swaks.PNG" alt="swaks" class="inline"/> <br/> <br/> <br/>
					
				In our netcat window we see an http connection attempt with the users creds.  <br/> <br/>
				<img src="images/sneaky/phished.PNG" alt="phished" class="inline"/> <br/> <br/> <br/>	
					
				After urldecoding the above password, we get <br/> <br/><br/>
					
				<code>
				Username: 	paulbyrd@sneakymailer.htb <br/>
				Password:	^(#J@SkFv2[%KhIxKk(Ju`hqcHl<:Ht <br/>
				</code>  <br/> <br/>
				
				With our new email creds, we should now be able to setup an email client and read through pauls emails. I opted to setup Evolution,
				which you can setup with a simple  <br/><br/><br/>
				<code>
				apt-get install evolution
				</code> <br/><br/><br/>
					
				After installing I configured the client with pauls email and pointed it at sneakcorp.htb, we are able to see 2 emails in pauls sent folder.<br/>
				The first is a set of credentials for the developer user <br/> <br/>
				<img src="images/sneaky/smtp-creds.PNG" alt="pauls emails" class="inline"/> <br/> <br/> <br/>
					
				And the 2nd gives us a piece of information, telling us that all of the packages in pypi are ran and tested by the low user. This may <br/>
				come in handy  if we need to pivot to the low user. <br/> <br/>
				<img src="images/sneaky/smtp-info.PNG" alt="pauls emails" class="inline"/> <br/> <br/> <br/>
					
				Our cred list is now - 
					
				<br/><br/><br/> <code>
				Username: 	paulbyrd@sneakymailer.htb 		<br/>
				Password:	^(#J@SkFv2[%KhIxKk(Ju`hqcHl<:Ht		<br/><br/>
										
				Username: 	developer				<br/>
				Password: 	m^AsY7vTKVT+dV1{WOU%@NaHkUAId3]C	<br/>
				</code><br/><br/><br/>
					
				Now with our handy developer creds, we are able to log into the ftp server. There is a /dev/ directory which we have access to, that looks like <br/>
				the same directory that is served on dev.sneakycorp.htb. So in theory we should be able to drop a reverse shell in there, then access it on the <br/>
				webserver in order to send a reverse connection back to our machine. <br/><br/><br/>
					
				I opted to use the php reverse shell from pentest monkey - <a href="http://pentestmonkey.net/tools/web-shells/php-reverse-shell">which you can checkout here</a> <br/> <br/>
					
				After setting up my ip/port info, I uploaded to the ftp server - <br/> <br/>
				<img src="images/sneaky/ftp.PNG" alt="uploading rev shell over ftp" class="inline"/> <br/> <br/> <br/>
					
				And after visiting the page in our browser we receive a connection back to our netcat <br/> <br/>
				<img src="images/sneaky/low-priv.PNG" alt="foothold" class="inline"/> <br/> <br/> <br/>
					
				We are dropped in a user shell as www-data, and can also use our earlier creds to change over to the developer user.		<br/>
				We are still unable to pull the user flag, as it is located in user low's directory. From here we will need to pivot 		<br/>
				to user low. 															<br/> <br/>
					
				The standard linenum script pulls out some creds from an open .htpasswd file for <b> pypi.sneakycorp.htb </b> 			<br/><br/>
				<img src="images/sneaky/pypi-creds.PNG" alt=".htpasswd creds" class="inline"/> 							<br/> <br/> <br/>
				
				Some further enumeration revealed this to be the port 8080 application that we were previously unable to see. 			<br/> <br/>
				<img src="images/sneaky/pypi-home-page.PNG" alt="port 8080 web app" class="inline"/> 						<br/> <br/> <br/>
					
				Remembering back to our 2nd email we discovered in pauls sent folder, every package in here is executed by the low user. 	<br/>
				So our gameplan from here is to figure out how to upload a malaicious package that low will then execute for us.		<br/>
				First step is to crack the hash from .htpasswd. We can determine the generic hash type from hash-identifier 			<br/> <br/>
				<img src="images/sneaky/pypi-creds2.PNG" alt="pypi" class="inline"/> 								<br/> <br/> <br/>
																  
				We can then find the actual hash type on the hashcat page, and then attempt to crack it 					<br/> <br/>
				<img src="images/sneaky/pypi-creds3.PNG" alt="pypi" class="inline"/> 								<br/> <br/> <br/>
				<img src="images/sneaky/pypi-creds4.PNG" alt="pypi" class="inline"/> 								<br/> <br/> <br/>
				
				Hashcat cracks it, and we can update our creds list  										<br/> <br/
					
				<br/><br/><br/> <code>
				(smtp)							<br/>
				Username: 	paulbyrd@sneakymailer.htb 		<br/>
				Password:	^(#J@SkFv2[%KhIxKk(Ju`hqcHl<:Ht		<br/><br/>
				
				(user acct)						<br/>
				Username: 	developer				<br/>
				Password: 	m^AsY7vTKVT+dV1{WOU%@NaHkUAId3]C	<br/>
				
				(pypi creds)						<br/>
				username: 	pypi					<br/>
 				password:	soufianeelhaoui				<br/><br/>
				</code><br/><br/><br/>
																  
				
				
				
				
				
					
				
				
					
				
			
			  	</p>
    		</div><!-- /.blurb -->
		<div class="blurb">	
		</div><!-- /.container -->
		
	</body>
</html>
