<!DOCTYPE html>
<html>
	
<style>
body {

	background-image: url('images/cool-background.png');
	background-attachment: fixed;
	color: #333;
}
</style>

<head>
<title>HackTheBox Feline Writeup </title>
<!-- link to main stylesheet -->
<link rel="stylesheet" type="css/main.css">
</head>
  
<body>
<div class="container">
 <div class="blurb">
 <h1>HTB Feline</h1>
 <p>
 	<img src="images/feline/feline.PNG" alt="feline" class="inline"/> 																					<br/> <br/> <br/>
	 
	 We start out with the usual nmap scan 																									<br/> <br/>
	<img src="images/feline/nmap.PNG" alt="nmap" class="inline"/> 																						<br/> <br/> <br/>
	 
	 The host is running apache tomcat 9.0.27 which is quite old, according to the apache site this was released back in 2019														<br/> <br/>
	 <img src="images/feline/tomcat-release.PNG" alt="tomcat release" class="inline"/> 																			<br/> <br/> <br/>
	 
	 The site is a mostly dead install with dummy links, but there is a VirusBucket section to upload file samples																<br/> <br/>
	 <img src="images/feline/web-server.PNG" alt="web page" class="inline"/> 																				<br/> <br/> <br/>
	 
	 I uploaded a sample to checkout the request in burp																							<br/> <br/>
	 <img src="images/feline/burp-upload.PNG" alt="burpsuite upload request" class="inline"/> 																		<br/> <br/> <br/>
	 
	 The site is passing the email and filename in headers, and passing the file as an image. We can also see that the requests are sent to /upload.jsp to be evaluated.									<br/> 
	 Some digging into tomcat 9.0.27 revealed this is potentially vulnerable to a deserialization attack (CVE-2020-9484)															<br/> <br/>
	 <img src="images/feline/apache-vuln.PNG" alt="tomcat vuln" class="inline"/> 																				<br/> <br/> <br/>
	 
	 <a href="https://github.com/masahiro331/CVE-2020-9484">There is a poc linked in several of the cve info pages (CVE-2020-9484)</a> 													<br/> <br/>
	 
	 I attempted to run this, I was able to succesfully upload the groovy session, but unable to trigger the stack traceback. 							<br/> <br/>                       
	 <img src="images/feline/user-1st-try.PNG" alt="POC exploit" class="inline"/> 																				<br/> <br/> <br/>
	 
	 I started thinking this was caused by an invalid upload path. The POC shows the default upload path to be <b>/usr/local/tomcat/</b> though we have not confirmed this on our instance. I started playing around with uploads		<br/>
	 via curl. After passing an empty filename, along with a valid image I was able to trigger a stack traceback that revealed the upload path to us.											<br/> <br/> <br/>
	 <img src="images/feline/upload-location.PNG" alt="POC exploit" class="inline"/> 																			<br/> <br/> <br/>
	 
	 Now can try to rerun the earlier POC exploit with our updated path <b>(/opt/samples/uploads/)</b>. We are able to see the full stack traceback as expected, thus confirming thea vulnerability.					<br/> <br/>                                 
	 <img src="images/feline/poc-confirmed.PNG" alt="POC exploit" class="inline"/> 																				<br/> <br/> <br/>
	 
	 
	 
	 
	 
	 
	 
	 
</p>
</div><!-- /.blurb -->
<div class="blurb">	
</div><!-- /.container -->		
</body>
</html>
		
